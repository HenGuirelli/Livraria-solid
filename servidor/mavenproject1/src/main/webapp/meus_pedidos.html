<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <link rel="stylesheet" href="resources/css/style.css">
        <link rel="stylesheet" href="resources/css/pedidos.css">
        <title>Livraria</title>
    </head>
    <body>
        <nav class="menu">
            <div class="acesso menu-direito">
                <button onClick="window.location.href = baseURL + '/login.html'">login</button>
                <button onClick="window.location.href = baseURL + '/cadastro.html'">cadastro</button>
            </div>
            <div class="meus-pedidos menu-direito">
                <button onClick="window.location.href = baseURL + '/meus_pedidos.html'">Meus pedidos</button>
            </div>

            <div class="pesquisa-livros">
                <input type="text" placeholder="Pesquisar por nome, editora ou autor" />
                <button>Pesquisar</button>
            </div>
        </nav>

        <h1 class="nome-livraria"></h1> <!-- nome livraria -->

        <main class="">
            <div class="pedidos">

            </div>
        </main>

    </body>
    <script src="resources/scripts/common.js"></script>
    <script src="resources/scripts/pedido.js"></script>

    <script type="text/javascript">
        getPedidos(sessionStorage.getItem('logado'))
        .then(result => {
            const $pedidos = document.querySelector('.pedidos')
            if (result === null || result === [] || result === undefined){
                const $aviso = document.createElement('h3')
                $aviso.innerHTML = 'Sem pedidos'

                $pedidos.appendChild($aviso)
            }else{
                console.log(result)
                result.forEach(pedido => {
                    const $pedido = document.createElement('div')
                    const $wrapTexto = document.createElement('div')
                    const $estado = document.createElement('span')
                    const $dataCriacao = document.createElement('span')
                    const $dataEmAtendimento = document.createElement('span')
                    const $entregue = document.createElement('span')
                    const $codigo = document.createElement('span')
                    const $cliente = document.createElement('span')

                    // foto dos produtos comprados
                    const $itens = document.createElement('div')
                    $itens.classList.add('wrapper-imagem-produto')

                    $wrapTexto.appendChild($estado)
                    $wrapTexto.appendChild($dataCriacao)
                    $wrapTexto.appendChild($dataEmAtendimento)
                    $wrapTexto.appendChild($entregue)
                    $wrapTexto.appendChild($codigo)
                    $wrapTexto.appendChild($cliente)

                    $pedido.appendChild($wrapTexto)
                    $pedido.appendChild($itens)
                    
                    $pedidos.appendChild($pedido)

                    $pedido.classList.add('pedido')

                    $estado.innerHTML = 'Estado do pedido: ' + pedido.estado
                    $dataCriacao.innerHTML = 'Criação do pedido ' +  (pedido.dataCriacao || 'Não iniciado')
                    $dataEmAtendimento.innerHTML = 'Em atendimento ' + (pedido.dataEmAtendimento || 'Não iniciado')
                    $entregue.innerHTML = 'Data de entrega: ' + (pedido.entregue || 'Não iniciado')
                    $codigo.innerHTML = 'Código do pedido: ' + pedido.codigo

                    pedido.produtos.forEach( ({ produto }) => {

                        const $item = document.createElement('img')
                        $item.setAttribute('src', produto.capa)
                        $itens.appendChild($item)

                    })

                })
            }
        })

    </script>
</html>